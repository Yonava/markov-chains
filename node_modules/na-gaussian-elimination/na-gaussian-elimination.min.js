/*!
 * na-gaussian-elimination
 * @see https://github.com/tfoxy/na-gaussian-elimination
 * @version 1.0.0
 * @author Tom√°s Fox <tomas.c.fox@gmail.com>
 * @license MIT
 */
!function(t,i){"use strict";"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?module.exports=i():t.GaussianElimination=i()}(this,function(){"use strict";var l=t("SolutionError"),i=t("OptionsError");return o.defaultOptions={zero:0,pivoting:"partial",lu:!1},o.SolutionError=l,o.OptionsError=i,(o.setEventEmitter=function(t){((o.prototype=Object.create(t.prototype)).constructor=o).prototype.solve=u,o.prototype._solve=c,o.prototype.forwardElimination=f,o.prototype._forwardElimination=m,o.prototype.backSubstitution=h,o.prototype._backSubstitution=p,o.prototype.setPivoting=n,o.prototype.setLuFlag=s,o.prototype.setZero=a})(function(){var t={prototype:{on:function(){throw new Error("An EventEmitter library needs to be set using GaussianElimination.setEventEmitter(EventEmitter) method. The /on/ function cannot be used otherwise")},emit:function(t,i){if("error"===t)throw i}}};if("object"==typeof module&&module.exports)try{t=require("events").EventEmitter}catch(t){}return t}()),o;function o(t){t=t||{},this.setPivoting(r("pivoting",t)),this.setLuFlag(r("lu",t)),this.setZero(r("zero",t))}function r(t,i){return t in i?i[t]:o.defaultOptions[t]}function t(t){function i(t){this.message=t,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}return((i.prototype=Object.create(Error.prototype)).constructor=i).prototype.name=t,i}function e(t){return t}function n(t){switch(t){case"partial":this._pivoting=v.bind(this);break;case"scaled":this._pivoting=function(t,i){var o=function(t,i){for(var o=d(t[i],i),r=i,e=i+1;e<t.length;e++){var n=d(t[e],i);0<n.comparedTo(o)&&(o=n,r=e)}return r}(t.matrix,i);b.call(this,t,i,o)}.bind(this);break;case"none":this._pivoting=function(t,i){if(t.matrix[i][i].isZero())throw new l("Pivot "+i+" is zero")}.bind(this);break;case"avoid zero":this._pivoting=function(t,i){t.matrix[i][i].isZero()&&v.call(this,t,i)}.bind(this);break;case"complete":this._pivoting=function(t,i){var o=function(t,i){var o,r,e=t.length,n=t[0].length,s=t[i][i].abs(),a={i:i,j:i},u=i;for(o=i+1;o<e;o++)0<(r=t[o][u].abs()).comparedTo(s)&&(s=r,a={i:o,j:u});for(o=i;o<e;o++)for(u=i+1;u<n;u++)0<(r=t[o][u].abs()).comparedTo(s)&&(s=r,a={i:o,j:u});return a}(t.matrix,i);b.call(this,t,i,o.i),function(t,i,o){i!==o&&(t.matrix.forEach(function(t){y(t,i,o)}),y(t.transformationVector,i,o),this.emit("swapColumns",{i:i,j:o,transformationVector:t.transformationVector}))}.call(this,t,i,o.j)}.bind(this);break;default:throw new i("Unknown pivoting method: "+t)}this._pivotingType=t}function s(t){this._getLowerMatrixValue=t?e:function(){return this._zero}.bind(this)}function a(t){this._zero=t}function u(t,i){try{return this._solve(t,i)}catch(t){return this.emit("error",t),null}}function c(t,o){this.emit("solveStart",{matrix:t,result:o});var r=this._forwardElimination(t,o),i=this._backSubstitution(t,o);return r.transformationVector.forEach(function(t,i){y(o,i,t),y(r.transformationVector,i,t)}),this.emit("solveEnd",i),i}function f(t,i){try{return this._forwardElimination(t,i)}catch(t){return this.emit("error",t),null}}function m(t,i){var o=t.length,r=t[0].length,e=Math.min(o,r),n="complete"===this._pivotingType?t[0].map(function(t,i){return i}):[],s={matrix:t,result:i,transformationVector:n},a={type:"forward",system:s};this.emit("eliminationStart",a);for(var u=0;u<e-1;u++){this._pivoting(s,u);var c=t[u][u];if(!c.isZero()){var f={k:u,pivot:c};this.emit("eliminationReduceColumnStart",f);for(var m=u+1;m<o;m++){var h,l=t[m],p=l[u].div(c),v={i:m,k:u,m:p,pivot:c};this.emit("eliminationReduceRowStart",v),l[u]=this._getLowerMatrixValue(p);for(var d=u+1;d<r;d++)h=p.times(t[u][d]),l[d]=l[d].minus(h);h=p.times(i[u]),i[m]=i[m].minus(h),this.emit("eliminationReduceRowEnd",v)}this.emit("eliminationReduceColumnEnd",f)}}return function(t,i,o){if(0<o)for(var r=t.length-1,e=o-1,n=e;n<r;++n)t[n][e].isZero()&&(y(t,n,r),y(i,n,r),--r)}(t,i,e),this.emit("eliminationEnd",a),s}function h(t,i){try{return this._backSubstitution(t,i)}catch(t){return this.emit("error",t),null}}function p(t,i){var o,r,e,n,s,a=t[0].length,u=t.length,c=u-Math.max(u-a,0);this.emit("substitutionStart",{type:"back",system:{matrix:t,result:i}});var f={matrix:t,solution:i,infiniteSolutions:!1};for(o=c-1;0<=o;o--){if(e=t[o],s=i[o],n=e[o],this.emit("substitutionOperationStart",{i:o}),s.isZero()&&n.isZero())i[o]=s,f.infiniteSolutions=!0;else{for(r=o+1;r<e.length;r++){var m=e[r].times(i[r]);s=s.minus(m)}if(n.isZero()){if(!s.isZero())throw new l("There is no solution for the system (a number multiplied by zero cannot be non-zero)");i[o]=s}else i[o]=s=s.div(n)}this.emit("substitutionOperationEnd",{i:o,value:s})}if(0<a){var h=i[c-1];for(o=c;o<u;o++){if(n=t[o][a-1],s=i[o],n.isZero()){if(s.isZero())continue;throw new l("There is no solution for the system (a number multiplied by zero cannot be non-zero)")}if(0!==s.div(n).comparedTo(h))throw new l("There is no solution for the system")}i.splice(c,Math.max(u-c,0))}return this.emit("substitutionEnd",{type:"back",system:f}),f}function v(t,i){var o=function(t,i){for(var o=t[i][i].abs(),r=i,e=i+1;e<t.length;e++){var n=t[e][i].abs();0<n.comparedTo(o)&&(o=n,r=e)}return r}(t.matrix,i);b.call(this,t,i,o)}function d(t,i){var o=function(t,i){for(var o=t[i].abs(),r=i+1;r<t.length;r++){var e=t[r].abs();0<e.comparedTo(o)&&(o=e)}return o}(t,i),r=t[i].abs();return o.isZero()?o:r.div(o)}function b(t,i,o){i!==o&&(y(t.matrix,i,o),y(t.result,i,o),this.emit("swapRows",{i:i,j:o}))}function y(t,i,o){var r=t[i];t[i]=t[o],t[o]=r}});